<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Voting Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { margin: 0; font-family: Arial, sans-serif; background: #f4f6f9; display: flex; }
.sidebar { width: 220px; background: #2c3e50; color: white; height: 100vh; padding: 20px; }
.sidebar h2 { margin-top: 0; font-size: 20px; }
.sidebar ul { list-style: none; padding: 0; }
.sidebar ul li { margin: 15px 0; }
.sidebar ul li a { color: white; text-decoration: none; font-size: 16px; }
.main { flex-grow: 1; padding: 20px; }
h1 { margin-bottom: 20px; }
.cards { display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
.card { flex: 1; background: white; padding: 20px; border-radius: 10px; text-align: center; min-width: 200px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);}
.card h3 { margin: 10px 0; font-size: 20px; }
.card p { font-size: 24px; font-weight: bold; }
.charts { display: flex; flex-wrap: wrap; gap: 30px; }
canvas { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
.button-panel { margin-bottom: 30px; display: flex; gap: 20px; flex-wrap: wrap; }
.button-panel button { padding: 10px 20px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; color: white; }
.button-panel .new-election { background: #e74c3c; }
.button-panel .new-election:hover { background: #c0392b; }
.button-panel .analytics { background: #2980b9; }
.button-panel .analytics:hover { background: #2471a3; }
.button-panel .system-admin { background: #16a085; }
.button-panel .system-admin:hover { background: #13856e; }
.button-panel .delete { background: #c0392b; }
.button-panel .delete:hover { background: #922b21; }
</style>
</head>
<body>
<div class="sidebar">
  <h2>Admin Panel</h2>
  <ul>
    <li><a href="#">Overview</a></li>
    <li><a href="create-election.html">New Election</a></li>
    <li><a href="analytics.html">Data Analytics</a></li>
    <li><a href="system-admin.html">System admin</a></li>
  </ul>
</div>

<div class="main">
  <h1>Voting Dashboard</h1>
  <div class="button-panel">
    <button class="new-election" onclick="window.location.href='create-election.html'">Create New Election</button>
    <button class="analytics" onclick="window.location.href='analytics.html'">Data Analytics</button>
    <button class="system-admin" onclick="window.location.href='system-admin.html'">System Admin</button>
    <button class="delete" onclick="deleteAllElections()">Delete All Elections</button>
  </div>

  <div class="cards">
    <div class="card" id="participationCard" style="background:#27ae60; color:white;">
      <h3>Participation</h3><p>0%</p>
    </div>
    <div class="card" id="votersCard" style="background:#2980b9; color:white;">
      <h3>Total Voters</h3><p>0</p>
    </div>
    <div class="card" id="ballotsCard" style="background:#e67e22; color:white;">
      <h3>Ballots</h3><p>0</p>
    </div>
    <div class="card" id="optionsCard" style="background:#8e44ad; color:white;">
      <h3>Options</h3><p>0</p>
    </div>
  </div>

  <div class="charts">
    <div style="flex:1;">
      <h3>Votes by Candidate</h3>
      <canvas id="barChart" height="200"></canvas>
    </div>
    <div style="flex:1;">
      <h3>Votes per Election</h3>
      <canvas id="pieChart" height="200"></canvas>
    </div>
    <div style="flex:1; min-width:400px;">
      <h3>Votes Over Time</h3>
      <canvas id="lineChart" height="200"></canvas>
    </div>
  </div>
</div>

<script>
// Load elections from localStorage
let allElections = JSON.parse(localStorage.getItem('allElections') || '[]');

// Aggregate data
let totalBallots = allElections.length;
let totalOptions = 0;
let candidateNames = [], candidateVotes = [];

allElections.forEach(election => {
  if(election.candidates){
    totalOptions += election.candidates.length;
    election.candidates.forEach(c => {
      candidateNames.push(c.name);
      candidateVotes.push(0); // start at 0 votes
    });
  }
});

// Participation & voters (separate, backend connected later)
let totalVoters = 0;
let participation = 0;

// Update cards
document.querySelector("#participationCard p").textContent = `${participation}%`;
document.querySelector("#votersCard p").textContent = totalVoters;
document.querySelector("#ballotsCard p").textContent = totalBallots;
document.querySelector("#optionsCard p").textContent = totalOptions;

// Bar Chart: Votes by candidate (starts blank)
new Chart(document.getElementById("barChart"), {
  type:'bar',
  data:{
    labels:candidateNames.length?candidateNames:['No Data'],
    datasets:[{
      label:'Votes',
      data:candidateVotes.length?candidateVotes:[0],
      backgroundColor:["#3498db","#2ecc71","#f1c40f","#e67e22","#9b59b6"]
    }]
  },
  options:{ responsive:true, scales:{ y:{ beginAtZero:true }} }
});

// Pie Chart: Votes per election
let electionNames = allElections.map(e => e.title);
let electionVotes = allElections.map(e => 0); // blank until votes come in
new Chart(document.getElementById("pieChart"), {
  type: 'pie',
  data: {
    labels: electionNames.length ? electionNames : ['No Elections'],
    datasets: [{
      label: 'Votes per Election',
      data: electionVotes.length ? electionVotes : [0],
      backgroundColor: electionNames.map((_,i) => ["#3498db","#2ecc71","#f1c40f","#e67e22","#9b59b6"][i % 5])
    }]
  },
  options: { responsive: true }
});

// Line Chart: Votes over time (starts blank)
let timeLabels = ["9AM","11AM","1PM","3PM","5PM"];
new Chart(document.getElementById("lineChart"), {
  type:'line',
  data:{ labels:timeLabels, datasets:[{label:'Votes Submitted', data:[0,0,0,0,0], borderColor:"#e74c3c", fill:true, backgroundColor:"rgba(231,76,60,0.2)"}] },
  options:{ responsive:true }
});

// Auto-update when localStorage changes
window.addEventListener('storage', ()=>location.reload());

// Function to delete all elections
function deleteAllElections() {
  if(confirm("Are you sure you want to delete all elections? This cannot be undone.")) {
    localStorage.removeItem('allElections');
    alert("All elections deleted.");
    location.reload();
  }
}
</script>
</body>
</html>
